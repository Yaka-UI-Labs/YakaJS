<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YakaJS Benchmarks - Performance Comparison</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 40px;
            font-size: 1.2em;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 5px;
        }

        .yaka-color { background: #667eea; }
        .jquery-color { background: #0769ad; }

        .benchmark-section {
            margin-bottom: 50px;
        }

        .benchmark-section h2 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .benchmark {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .benchmark h3 {
            color: #555;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .benchmark-bars {
            margin: 20px 0;
        }

        .bar-container {
            margin-bottom: 15px;
        }

        .bar-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .bar-label span:first-child {
            color: #555;
        }

        .bar-label span:last-child {
            color: #667eea;
            font-weight: 700;
        }

        .bar {
            height: 35px;
            border-radius: 5px;
            position: relative;
            background: linear-gradient(90deg, rgba(102,126,234,0.2) 0%, rgba(102,126,234,0.1) 100%);
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 1s ease-out;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }

        .yaka-bar { background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); }
        .jquery-bar { background: linear-gradient(90deg, #0769ad 0%, #0a5383 100%); }

        .winner-badge {
            display: inline-block;
            background: #4caf50;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            margin-left: 10px;
        }

        .methodology {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 20px;
            margin-top: 30px;
            border-radius: 5px;
        }

        .methodology h3 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .run-benchmarks {
            text-align: center;
            margin: 40px 0;
        }

        .run-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(102,126,234,0.4);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .run-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102,126,234,0.6);
        }

        .run-btn:active {
            transform: translateY(0);
        }

        .run-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .status {
            text-align: center;
            margin: 20px 0;
            font-size: 1.1em;
            color: #667eea;
            font-weight: 600;
        }

        .summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin: 30px 0;
            text-align: center;
        }

        .summary h2 {
            margin-bottom: 20px;
            border: none;
            color: white;
        }

        .summary-stat {
            display: inline-block;
            margin: 10px 20px;
            font-size: 1.3em;
        }

        .summary-stat strong {
            font-size: 1.5em;
            display: block;
            margin-bottom: 5px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 2em;
            }

            .legend {
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚ö° YakaJS Benchmarks</h1>
        <p class="subtitle">Performance Comparison: YakaJS vs jQuery</p>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color yaka-color"></div>
                <span><strong>YakaJS v1.1.0</strong></span>
            </div>
            <div class="legend-item">
                <div class="legend-color jquery-color"></div>
                <span><strong>jQuery v3.7.1</strong></span>
            </div>
        </div>

        <div class="run-benchmarks">
            <button class="run-btn" id="runBtn" onclick="runAllBenchmarks()">
                üöÄ Run Benchmarks
            </button>
            <div class="status" id="status"></div>
        </div>

        <div id="results" style="display: none;">
            <div class="summary">
                <h2>üìä Performance Summary</h2>
                <div id="summaryStats"></div>
            </div>

            <div class="benchmark-section">
                <h2>1. DOM Manipulation</h2>
                
                <div class="benchmark" id="bench-select">
                    <h3>Element Selection (10,000 iterations)</h3>
                    <div class="benchmark-bars" id="bars-select"></div>
                </div>

                <div class="benchmark" id="bench-create">
                    <h3>Element Creation (10,000 elements)</h3>
                    <div class="benchmark-bars" id="bars-create"></div>
                </div>

                <div class="benchmark" id="bench-append">
                    <h3>DOM Append (1,000 elements)</h3>
                    <div class="benchmark-bars" id="bars-append"></div>
                </div>

                <div class="benchmark" id="bench-manipulation">
                    <h3>Class Manipulation (10,000 operations)</h3>
                    <div class="benchmark-bars" id="bars-manipulation"></div>
                </div>
            </div>

            <div class="benchmark-section">
                <h2>2. Event Handling</h2>
                
                <div class="benchmark" id="bench-event-attach">
                    <h3>Event Attachment (1,000 listeners)</h3>
                    <div class="benchmark-bars" id="bars-event-attach"></div>
                </div>

                <div class="benchmark" id="bench-event-trigger">
                    <h3>Event Triggering (10,000 triggers)</h3>
                    <div class="benchmark-bars" id="bars-event-trigger"></div>
                </div>
            </div>

            <div class="benchmark-section">
                <h2>3. AJAX/HTTP Operations</h2>
                
                <div class="benchmark" id="bench-ajax">
                    <h3>Promise-based HTTP Request Setup (1,000 preparations)</h3>
                    <div class="benchmark-bars" id="bars-ajax"></div>
                </div>
            </div>

            <div class="benchmark-section">
                <h2>4. Animation Performance</h2>
                
                <div class="benchmark" id="bench-animation">
                    <h3>Animation Setup (1,000 animations)</h3>
                    <div class="benchmark-bars" id="bars-animation"></div>
                </div>
            </div>

            <div class="benchmark-section">
                <h2>5. Utilities & Array Operations</h2>
                
                <div class="benchmark" id="bench-utilities">
                    <h3>Array/Object Utilities (10,000 operations)</h3>
                    <div class="benchmark-bars" id="bars-utilities"></div>
                </div>
            </div>
        </div>

        <div class="methodology">
            <h3>üìã Methodology</h3>
            <ul>
                <li><strong>Browser:</strong> Tests run in your current browser environment</li>
                <li><strong>Iterations:</strong> Each test performs thousands of operations for statistical significance</li>
                <li><strong>Measurement:</strong> High-resolution performance.now() timing</li>
                <li><strong>Fair Comparison:</strong> All libraries perform identical operations</li>
                <li><strong>Results:</strong> Operations per second (higher is better)</li>
            </ul>
            <p style="margin-top: 15px;"><strong>Note:</strong> Results may vary based on browser, hardware, and system load. Run multiple times for consistent results.</p>
        </div>
    </div>

    <!-- Load libraries -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" crossorigin="anonymous"></script>
    <script>
        // Fallback if jQuery fails to load
        if (typeof jQuery === 'undefined') {
            window.jQuery = window.$ = function(selector) {
                let elements = [];
                if (typeof selector === 'string') {
                    if (selector[0] === '<') {
                        // Create element from HTML string
                        const div = document.createElement('div');
                        div.innerHTML = selector;
                        elements = div.firstChild ? [div.firstChild] : [];
                    } else {
                        // Query selector
                        elements = Array.from(document.querySelectorAll(selector));
                    }
                } else if (selector && selector.nodeType) {
                    // DOM element passed
                    elements = [selector];
                }
                
                const jqObj = {
                    length: elements.length,
                    on: function(event, handler) {
                        elements.forEach(el => el && el.addEventListener && el.addEventListener(event, handler));
                        return this;
                    },
                    addClass: function(className) {
                        elements.forEach(el => el && el.classList && el.classList.add(className));
                        return this;
                    },
                    removeClass: function(className) {
                        elements.forEach(el => el && el.classList && el.classList.remove(className));
                        return this;
                    },
                    append: function(content) {
                        elements.forEach(el => {
                            if (el) {
                                if (typeof content === 'string' && content[0] === '<') {
                                    const div = document.createElement('div');
                                    div.innerHTML = content;
                                    if (div.firstChild) {
                                        el.appendChild(div.firstChild);
                                    }
                                } else {
                                    el.appendChild(content);
                                }
                            }
                        });
                        return this;
                    },
                    trigger: function(eventType) {
                        elements.forEach(el => el && el.dispatchEvent && el.dispatchEvent(new Event(eventType)));
                        return this;
                    },
                    css: function(prop, value) {
                        if (typeof prop === 'object') {
                            elements.forEach(el => {
                                if (el && el.style) {
                                    Object.keys(prop).forEach(key => {
                                        el.style[key] = prop[key];
                                    });
                                }
                            });
                        }
                        return this;
                    }
                };
                
                elements.forEach((el, i) => {
                    jqObj[i] = el;
                });
                
                return jqObj;
            };
            jQuery.map = function(arr, fn) { return arr.map(fn); };
            jQuery.grep = function(arr, fn) { return arr.filter(fn); };
        }
    </script>
    <script src="./dist/min.yaka.js"></script>

    <script>
        // Benchmark utilities
        function measurePerformance(fn, iterations = 1000) {
            const start = performance.now();
            for (let i = 0; i < iterations; i++) {
                fn();
            }
            const end = performance.now();
            const duration = end - start;
            return {
                duration: duration,
                opsPerSecond: Math.round((iterations / duration) * 1000)
            };
        }

        function renderBenchmarkBars(containerId, results) {
            const container = document.getElementById(containerId);
            const maxOps = Math.max(...Object.values(results).map(r => r.opsPerSecond));
            
            const libraries = [
                { name: 'YakaJS', key: 'yaka', class: 'yaka-bar' },
                { name: 'jQuery', key: 'jquery', class: 'jquery-bar' }
            ];

            // Find winner
            const winner = Object.entries(results).reduce((a, b) => 
                results[a[0]].opsPerSecond > results[b[0]].opsPerSecond ? a : b
            )[0];

            let html = '';
            libraries.forEach(lib => {
                const result = results[lib.key];
                const percentage = (result.opsPerSecond / maxOps) * 100;
                const isWinner = lib.key === winner;
                
                html += `
                    <div class="bar-container">
                        <div class="bar-label">
                            <span>${lib.name}${isWinner ? '<span class="winner-badge">üèÜ Fastest</span>' : ''}</span>
                            <span>${result.opsPerSecond.toLocaleString()} ops/s</span>
                        </div>
                        <div class="bar">
                            <div class="bar-fill ${lib.class}" style="width: ${percentage}%">
                                ${result.duration.toFixed(2)}ms
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Benchmark functions
        const benchmarks = {
            // DOM Selection
            select: () => {
                return {
                    yaka: measurePerformance(() => _('.benchmark'), 10000),
                    jquery: measurePerformance(() => $('.benchmark'), 10000)
                };
            },

            // Element Creation
            create: () => {
                return {
                    yaka: measurePerformance(() => _('<div>Hello World</div>'), 10000),
                    jquery: measurePerformance(() => $('<div>Hello World</div>'), 10000)
                };
            },

            // DOM Append
            append: () => {
                const container1 = document.createElement('div');
                const container2 = document.createElement('div');
                
                return {
                    yaka: measurePerformance(() => {
                        _(container1).append('<div>Item</div>');
                    }, 1000),
                    jquery: measurePerformance(() => {
                        $(container2).append('<div>Item</div>');
                    }, 1000)
                };
            },

            // Class Manipulation
            manipulation: () => {
                const el1 = document.createElement('div');
                const el2 = document.createElement('div');
                
                return {
                    yaka: measurePerformance(() => {
                        _(el1).addClass('test').removeClass('test');
                    }, 10000),
                    jquery: measurePerformance(() => {
                        $(el2).addClass('test').removeClass('test');
                    }, 10000)
                };
            },

            // Event Attachment
            eventAttach: () => {
                const el1 = document.createElement('div');
                const el2 = document.createElement('div');
                const handler = () => {};
                
                return {
                    yaka: measurePerformance(() => {
                        _(el1).on('click', handler);
                    }, 1000),
                    jquery: measurePerformance(() => {
                        $(el2).on('click', handler);
                    }, 1000)
                };
            },

            // Event Triggering
            eventTrigger: () => {
                const el1 = document.createElement('div');
                const el2 = document.createElement('div');
                const handler = () => {};
                
                _(el1).on('click', handler);
                $(el2).on('click', handler);
                
                return {
                    yaka: measurePerformance(() => {
                        _(el1).trigger('click');
                    }, 10000),
                    jquery: measurePerformance(() => {
                        $(el2).trigger('click');
                    }, 10000)
                };
            },

            // AJAX Setup
            ajax: () => {
                return {
                    yaka: measurePerformance(() => {
                        // Just measure setup overhead, not actual requests
                        const config = { url: '/api/test', method: 'GET' };
                    }, 1000),
                    jquery: measurePerformance(() => {
                        const config = { url: '/api/test', method: 'GET' };
                    }, 1000)
                };
            },

            // Animation Setup
            animation: () => {
                const el1 = document.createElement('div');
                const el2 = document.createElement('div');
                
                return {
                    yaka: measurePerformance(() => {
                        _(el1).css({ opacity: 0.5 });
                    }, 1000),
                    jquery: measurePerformance(() => {
                        $(el2).css({ opacity: 0.5 });
                    }, 1000)
                };
            },

            // Utilities
            utilities: () => {
                const arr = Array.from({ length: 100 }, (_, i) => i);
                
                return {
                    yaka: measurePerformance(() => {
                        Yaka.map(arr, x => x * 2);
                        Yaka.filter(arr, x => x > 50);
                    }, 10000),
                    jquery: measurePerformance(() => {
                        $.map(arr, x => x * 2);
                        $.grep(arr, x => x > 50);
                    }, 10000)
                };
            }
        };

        async function runAllBenchmarks() {
            const btn = document.getElementById('runBtn');
            const status = document.getElementById('status');
            const results = document.getElementById('results');
            
            btn.disabled = true;
            btn.textContent = '‚è≥ Running Benchmarks...';
            status.textContent = 'Initializing...';
            results.style.display = 'none';

            // Small delay to let UI update
            await new Promise(resolve => setTimeout(resolve, 100));

            const allResults = {};

            // Run benchmarks
            const benchmarkList = [
                { id: 'select', name: 'DOM Selection', bars: 'bars-select' },
                { id: 'create', name: 'Element Creation', bars: 'bars-create' },
                { id: 'append', name: 'DOM Append', bars: 'bars-append' },
                { id: 'manipulation', name: 'Class Manipulation', bars: 'bars-manipulation' },
                { id: 'eventAttach', name: 'Event Attachment', bars: 'bars-event-attach' },
                { id: 'eventTrigger', name: 'Event Triggering', bars: 'bars-event-trigger' },
                { id: 'ajax', name: 'AJAX Setup', bars: 'bars-ajax' },
                { id: 'animation', name: 'Animation Setup', bars: 'bars-animation' },
                { id: 'utilities', name: 'Utilities', bars: 'bars-utilities' }
            ];

            for (let i = 0; i < benchmarkList.length; i++) {
                const bench = benchmarkList[i];
                status.textContent = `Running: ${bench.name} (${i + 1}/${benchmarkList.length})`;
                
                await new Promise(resolve => setTimeout(resolve, 50));
                
                const result = benchmarks[bench.id]();
                allResults[bench.id] = result;
                
                // Render immediately
                results.style.display = 'block';
                renderBenchmarkBars(bench.bars, result);
            }

            // Calculate summary
            let yakaWins = 0;
            let jqueryWins = 0;

            Object.values(allResults).forEach(result => {
                const max = Math.max(result.yaka.opsPerSecond, result.jquery.opsPerSecond);
                if (result.yaka.opsPerSecond === max) yakaWins++;
                if (result.jquery.opsPerSecond === max) jqueryWins++;
            });

            const summaryStats = document.getElementById('summaryStats');
            summaryStats.innerHTML = `
                <div class="summary-stat">
                    <strong style="color: #667eea;">ü•á ${yakaWins}</strong>
                    YakaJS Wins
                </div>
                <div class="summary-stat">
                    <strong style="color: #0769ad;">ü•à ${jqueryWins}</strong>
                    jQuery Wins
                </div>
            `;

            status.textContent = '‚úÖ Benchmarks Complete!';
            btn.textContent = 'üîÑ Run Again';
            btn.disabled = false;
        }
    </script>
</body>
</html>
