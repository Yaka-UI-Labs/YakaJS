<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="test-csrf-token-12345">
    <title>YakaJS - jQuery-Beating Features Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }
        
        .section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h2 {
            color: #667eea;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
            font-size: 1.5em;
        }
        
        .test-group {
            margin: 15px 0;
        }
        
        .test-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        
        input[type="text"],
        input[type="email"],
        input[type="number"],
        input[type="url"],
        textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        input:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin: 5px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .output {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .success {
            color: #28a745;
            font-weight: bold;
        }
        
        .error {
            color: #dc3545;
            font-weight: bold;
        }
        
        .info {
            color: #17a2b8;
        }
        
        .metric {
            display: inline-block;
            background: #e9ecef;
            padding: 8px 15px;
            border-radius: 20px;
            margin: 5px;
            font-size: 13px;
        }
        
        .metric strong {
            color: #667eea;
        }
        
        #router-view {
            min-height: 200px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        
        .route-link {
            display: inline-block;
            padding: 8px 15px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            margin: 5px;
            font-size: 14px;
        }
        
        .route-link:hover {
            background: #764ba2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ YakaJS - jQuery-Beating Features</h1>
        
        <div class="grid">
            <!-- HTTP Error Handling -->
            <div class="section">
                <h2>1. Enhanced HTTP with Error Handling</h2>
                
                <button onclick="testHTTPSuccess()">Test Successful Request</button>
                <button onclick="testHTTPError()">Test Error Handling</button>
                <button onclick="testHTTPTimeout()">Test Timeout</button>
                <button onclick="testHTTPRetry()">Test Retry Logic</button>
                <button onclick="testHTTPCache()">Test HTTP Cache</button>
                
                <div id="http-output" class="output"></div>
            </div>
            
            <!-- Advanced Routing -->
            <div class="section">
                <h2>2. Advanced Routing</h2>
                
                <div>
                    <a href="#" class="route-link" onclick="router.navigate('/'); return false;">Home</a>
                    <a href="#" class="route-link" onclick="router.navigate('/about'); return false;">About</a>
                    <a href="#" class="route-link" onclick="router.navigate('/user/123'); return false;">User 123</a>
                    <a href="#" class="route-link" onclick="router.navigate('/user/456?tab=posts'); return false;">User 456 Posts</a>
                    <a href="#" class="route-link" onclick="router.navigate('/admin'); return false;">Admin (Guarded)</a>
                    <a href="#" class="route-link" onclick="router.navigate('/notfound'); return false;">404 Test</a>
                </div>
                
                <div id="router-view"></div>
                <div id="router-output" class="output"></div>
            </div>
            
            <!-- Form Validation -->
            <div class="section">
                <h2>3. Advanced Form Validation</h2>
                
                <form id="test-form">
                    <div class="test-group">
                        <label>Email (required, email)</label>
                        <input type="email" name="email" placeholder="user@example.com">
                    </div>
                    
                    <div class="test-group">
                        <label>URL (required, url)</label>
                        <input type="url" name="website" placeholder="https://example.com">
                    </div>
                    
                    <div class="test-group">
                        <label>Age (number, min 18, max 100)</label>
                        <input type="number" name="age" placeholder="25">
                    </div>
                    
                    <div class="test-group">
                        <label>Phone (required, phone)</label>
                        <input type="text" name="phone" placeholder="(123) 456-7890">
                    </div>
                    
                    <div class="test-group">
                        <label>Password (required, minLength 8)</label>
                        <input type="text" name="password" placeholder="password123">
                    </div>
                    
                    <div class="test-group">
                        <label>Confirm Password (match password)</label>
                        <input type="text" name="confirm_password" placeholder="password123">
                    </div>
                    
                    <button type="button" onclick="testValidation()">Validate Form</button>
                    <button type="button" onclick="enableRealTimeValidation()">Enable Real-Time</button>
                </form>
                
                <div id="validation-output" class="output"></div>
            </div>
            
            <!-- Security Features -->
            <div class="section">
                <h2>4. Security Utilities</h2>
                
                <div class="test-group">
                    <label>XSS Test Input:</label>
                    <input type="text" id="xss-input" value="<script>alert('XSS')</script>">
                    <button onclick="testXSS()">Test XSS Sanitization</button>
                </div>
                
                <div class="test-group">
                    <label>URL Sanitization:</label>
                    <input type="text" id="url-input" value="javascript:alert('bad')">
                    <button onclick="testURLSanitize()">Sanitize URL</button>
                </div>
                
                <button onclick="testCSRF()">Test CSRF Token</button>
                
                <div id="security-output" class="output"></div>
            </div>
            
            <!-- State Management -->
            <div class="section">
                <h2>5. Advanced State Management</h2>
                
                <div class="test-group">
                    <button onclick="testStoreBasics()">Test Store Basics</button>
                    <button onclick="testStoreActions()">Test Async Actions</button>
                    <button onclick="testTimeTravel()">Test Time Travel</button>
                    <button onclick="testStorePersist()">Test Persistence</button>
                </div>
                
                <div>
                    <div class="metric">Counter: <strong id="counter-display">0</strong></div>
                    <div class="metric">Todos: <strong id="todos-display">0</strong></div>
                </div>
                
                <div id="store-output" class="output"></div>
            </div>
            
            <!-- Performance Monitoring -->
            <div class="section">
                <h2>6. Performance Monitoring</h2>
                
                <button onclick="testPerformanceMark()">Test Performance Marks</button>
                <button onclick="testFPS()">Measure FPS</button>
                <button onclick="testPerformanceReport()">Get Full Report</button>
                
                <div id="performance-output" class="output"></div>
            </div>
        </div>
    </div>
    
    <script src="yaka.js"></script>
    <script>
        // Enable debug mode
        _.debug = true;
        
        // ===== HTTP TESTS =====
        function testHTTPSuccess() {
            const output = document.getElementById('http-output');
            output.innerHTML = '<span class="info">Testing successful request...</span>\n';
            
            // Simulate success with JSONPlaceholder API
            _.get('https://jsonplaceholder.typicode.com/posts/1', null, { timeout: 5000 })
                .then(data => {
                    output.innerHTML += '<span class="success">‚úÖ Success!</span>\n';
                    output.innerHTML += 'Title: ' + data.title + '\n';
                })
                .catch(err => {
                    output.innerHTML += '<span class="error">‚ùå Error: ' + err.message + '</span>\n';
                });
        }
        
        function testHTTPError() {
            const output = document.getElementById('http-output');
            output.innerHTML = '<span class="info">Testing error handling...</span>\n';
            
            _.get('https://jsonplaceholder.typicode.com/posts/99999999')
                .then(data => {
                    output.innerHTML += '<span class="success">‚úÖ Response received</span>\n';
                })
                .catch(err => {
                    output.innerHTML += '<span class="error">‚úÖ Error handled correctly!</span>\n';
                    output.innerHTML += 'Error: ' + err.message + '\n';
                });
        }
        
        function testHTTPTimeout() {
            const output = document.getElementById('http-output');
            output.innerHTML = '<span class="info">Testing timeout (set to 100ms)...</span>\n';
            
            _.get('https://jsonplaceholder.typicode.com/posts/1', null, { 
                timeout: 100,
                onError: (err) => {
                    output.innerHTML += '<span class="info">Error callback triggered</span>\n';
                }
            })
                .then(data => {
                    output.innerHTML += '<span class="success">Completed</span>\n';
                })
                .catch(err => {
                    output.innerHTML += '<span class="error">‚úÖ Timeout handled!</span>\n';
                    output.innerHTML += err.message + '\n';
                });
        }
        
        function testHTTPRetry() {
            const output = document.getElementById('http-output');
            output.innerHTML = '<span class="info">Testing retry logic...</span>\n';
            
            let attempt = 0;
            _.get('https://httpstat.us/500', null, { 
                retries: 2,
                retryDelay: 500,
                timeout: 5000
            })
                .then(data => {
                    output.innerHTML += '<span class="success">Success</span>\n';
                })
                .catch(err => {
                    output.innerHTML += '<span class="info">‚úÖ Retry logic executed</span>\n';
                    output.innerHTML += 'Final error: ' + err.message + '\n';
                });
        }
        
        function testHTTPCache() {
            const output = document.getElementById('http-output');
            output.innerHTML = '<span class="info">Testing HTTP cache...</span>\n';
            
            const url = 'https://jsonplaceholder.typicode.com/posts/1';
            
            // First request (cache miss)
            const start1 = performance.now();
            _.cache.request(url, { method: 'GET', cacheTTL: 60000 })
                .then(data => {
                    const time1 = (performance.now() - start1).toFixed(2);
                    output.innerHTML += `<span class="info">First request: ${time1}ms (cache miss)</span>\n`;
                    
                    // Second request (cache hit)
                    const start2 = performance.now();
                    _.cache.request(url, { method: 'GET' })
                        .then(data2 => {
                            const time2 = (performance.now() - start2).toFixed(2);
                            output.innerHTML += `<span class="success">‚úÖ Second request: ${time2}ms (cache hit)</span>\n`;
                            output.innerHTML += `Speedup: ${(time1 / time2).toFixed(0)}x faster\n`;
                        });
                });
        }
        
        // ===== ROUTING TESTS =====
        const router = _.createRouter({
            baseUrl: '',
            notFoundHandler: (path) => {
                document.getElementById('router-output').innerHTML = 
                    '<span class="error">404: Route not found - ' + path + '</span>';
            }
        });
        
        // Add routes
        router.addRoute('/', {
            name: 'home',
            component: () => '<h3>üè† Home Page</h3><p>Welcome to the home page!</p>',
            target: '#router-view',
            handler: () => {
                document.getElementById('router-output').innerHTML = 
                    '<span class="success">‚úÖ Navigated to Home</span>';
            }
        });
        
        router.addRoute('/about', {
            name: 'about',
            component: () => '<h3>‚ÑπÔ∏è About Page</h3><p>Learn about us here.</p>',
            target: '#router-view'
        });
        
        router.addRoute('/user/:id', {
            name: 'user',
            component: (params, query) => {
                return `<h3>üë§ User Profile</h3>
                        <p>User ID: ${params.id}</p>
                        <p>Query Tab: ${query.tab || 'overview'}</p>`;
            },
            target: '#router-view',
            handler: (params, query) => {
                document.getElementById('router-output').innerHTML = 
                    `<span class="success">‚úÖ User ${params.id} loaded</span>` +
                    (query.tab ? `\nTab: ${query.tab}` : '');
            }
        });
        
        router.addRoute('/admin', {
            name: 'admin',
            beforeEnter: async (route, from) => {
                // Simulate auth check
                const isAuthenticated = false;
                if (!isAuthenticated) {
                    alert('Access denied! Redirecting to home...');
                    router.navigate('/');
                    return false;
                }
                return true;
            },
            component: () => '<h3>üîê Admin Panel</h3><p>Admin content here.</p>',
            target: '#router-view'
        });
        
        // Global guards
        router.beforeEach((to, from) => {
            console.log('Before navigation:', to.path);
            return true;
        });
        
        router.afterEach((to, from) => {
            console.log('After navigation:', to.path);
        });
        
        // Initialize router
        router.init();
        
        // ===== VALIDATION TESTS =====
        function testValidation() {
            const result = _('#test-form').validateForm({
                email: { required: true, email: true },
                website: { required: true, url: true },
                age: { number: true, min: 18, max: 100 },
                phone: { required: true, phone: true },
                password: { required: true, minLength: 8 },
                confirm_password: { match: 'password' }
            }, { showErrors: true });
            
            const output = document.getElementById('validation-output');
            if (result.valid) {
                output.innerHTML = '<span class="success">‚úÖ Form is valid!</span>';
            } else {
                output.innerHTML = '<span class="error">‚ùå Validation errors:</span>\n';
                Object.entries(result.errors).forEach(([field, errors]) => {
                    output.innerHTML += `${field}: ${errors.join(', ')}\n`;
                });
            }
        }
        
        function enableRealTimeValidation() {
            _('#test-form').validateForm({
                email: { required: true, email: true },
                website: { required: true, url: true },
                age: { number: true, min: 18, max: 100 },
                phone: { required: true, phone: true },
                password: { required: true, minLength: 8 },
                confirm_password: { match: 'password' }
            }, { realTime: true, showErrors: true });
            
            document.getElementById('validation-output').innerHTML = 
                '<span class="success">‚úÖ Real-time validation enabled!</span>';
        }
        
        // ===== SECURITY TESTS =====
        function testXSS() {
            const input = document.getElementById('xss-input').value;
            const sanitized = _.security.escapeHtml(input);
            
            const output = document.getElementById('security-output');
            output.innerHTML = '<span class="info">Original:</span> ' + input + '\n';
            output.innerHTML += '<span class="success">Sanitized:</span> ' + sanitized + '\n';
            output.innerHTML += '<span class="info">Safe to display:</span> ' + sanitized;
        }
        
        function testURLSanitize() {
            const input = document.getElementById('url-input').value;
            const sanitized = _.security.sanitizeUrl(input);
            
            const output = document.getElementById('security-output');
            output.innerHTML = '<span class="info">Original:</span> ' + input + '\n';
            output.innerHTML += '<span class="success">Sanitized:</span> ' + (sanitized || '(removed - unsafe protocol)') + '\n';
        }
        
        function testCSRF() {
            const token = _.security.csrf.getToken();
            
            const output = document.getElementById('security-output');
            output.innerHTML = '<span class="success">‚úÖ CSRF Token Retrieved:</span>\n';
            output.innerHTML += token + '\n\n';
            output.innerHTML += '<span class="info">Token will be automatically added to all HTTP requests</span>';
        }
        
        // ===== STATE MANAGEMENT TESTS =====
        const store = _.createStore({
            state: {
                counter: 0,
                todos: []
            },
            getters: {
                todoCount: (state) => state.todos.length,
                completedTodos: (state) => state.todos.filter(t => t.completed)
            },
            mutations: {
                increment(state, amount = 1) {
                    state.counter += amount;
                },
                addTodo(state, todo) {
                    state.todos.push(todo);
                }
            },
            actions: {
                async fetchTodos(context) {
                    // Simulate API call
                    const response = await _.get('https://jsonplaceholder.typicode.com/todos?_limit=5');
                    response.forEach(todo => {
                        context.commit('addTodo', todo);
                    });
                }
            }
        });
        
        // Subscribe to state changes
        store.subscribe((mutation, state) => {
            document.getElementById('counter-display').textContent = state.counter;
            document.getElementById('todos-display').textContent = state.todos.length;
        });
        
        function testStoreBasics() {
            const output = document.getElementById('store-output');
            output.innerHTML = '<span class="info">Testing store basics...</span>\n';
            
            store.commit('increment', 5);
            output.innerHTML += '<span class="success">‚úÖ Counter incremented by 5</span>\n';
            output.innerHTML += 'Counter: ' + store.state.counter + '\n';
        }
        
        function testStoreActions() {
            const output = document.getElementById('store-output');
            output.innerHTML = '<span class="info">Fetching todos...</span>\n';
            
            store.dispatch('fetchTodos').then(() => {
                output.innerHTML += '<span class="success">‚úÖ Todos fetched!</span>\n';
                output.innerHTML += 'Total todos: ' + store.get('todoCount') + '\n';
            });
        }
        
        function testTimeTravel() {
            const output = document.getElementById('store-output');
            output.innerHTML = '<span class="info">Time travel demo...</span>\n';
            
            store.commit('increment', 1);
            store.commit('increment', 1);
            store.commit('increment', 1);
            
            output.innerHTML += 'Counter after 3 increments: ' + store.state.counter + '\n';
            
            store.undo();
            output.innerHTML += '<span class="success">‚úÖ Undo: ' + store.state.counter + '</span>\n';
            
            store.undo();
            output.innerHTML += '<span class="success">‚úÖ Undo: ' + store.state.counter + '</span>\n';
            
            store.redo();
            output.innerHTML += '<span class="info">Redo: ' + store.state.counter + '</span>\n';
        }
        
        function testStorePersist() {
            const output = document.getElementById('store-output');
            
            store.persist();
            output.innerHTML = '<span class="success">‚úÖ State persisted to localStorage</span>\n';
            output.innerHTML += 'Try refreshing the page - state will be restored!\n';
            
            // Restore on page load
            store.restore();
        }
        
        // ===== PERFORMANCE TESTS =====
        function testPerformanceMark() {
            const output = document.getElementById('performance-output');
            output.innerHTML = '<span class="info">Measuring performance...</span>\n';
            
            _.performance.mark('start');
            
            // Simulate work
            let sum = 0;
            for (let i = 0; i < 1000000; i++) {
                sum += i;
            }
            
            _.performance.mark('end');
            const duration = _.performance.measure('calculation', 'start', 'end');
            
            output.innerHTML += `<span class="success">‚úÖ Calculation took ${duration.toFixed(2)}ms</span>\n`;
        }
        
        function testFPS() {
            const output = document.getElementById('performance-output');
            output.innerHTML = '<span class="info">Measuring FPS...</span>\n';
            
            _.performance.getFPS((fps) => {
                output.innerHTML += `<span class="success">‚úÖ FPS: ${fps}</span>\n`;
            }, 2000);
        }
        
        function testPerformanceReport() {
            const output = document.getElementById('performance-output');
            const report = _.performance.getReport();
            
            output.innerHTML = '<span class="success">‚úÖ Performance Report:</span>\n\n';
            
            if (report.memory) {
                output.innerHTML += '<span class="info">Memory Usage:</span>\n';
                output.innerHTML += JSON.stringify(report.memory, null, 2) + '\n\n';
            }
            
            if (report.navigation) {
                output.innerHTML += '<span class="info">Navigation Timing:</span>\n';
                output.innerHTML += JSON.stringify(report.navigation, null, 2) + '\n';
            }
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ YakaJS jQuery-Beating Features loaded!');
            
            // Restore store state if exists
            store.restore();
        });
    </script>
</body>
</html>
